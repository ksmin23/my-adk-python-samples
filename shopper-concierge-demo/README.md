# Shopper's Concierge Agent

This demo showcases an advanced shopping assistant that uses a sub-agent for research to provide more relevant product recommendations. It includes an ADK-based agent and a Gradio web interface for interaction.

## Overview

This agent is built using the Google Agent Development Kit (ADK). It demonstrates a multi-agent architecture where a primary "concierge" agent delegates research tasks to a specialized sub-agent.

- **`shopper_concierge/`**: The core ADK agent.
  - **`agent.py`**: Defines the main `root_agent` which orchestrates the workflow.
  - **`sub_agents/research_agent.py`**: A sub-agent that uses Google Search to understand user intent and generate relevant search queries.
  - **`tools.py`**: Contains the `find_shopping_items` tool, which queries a vector search backend to find products based on the queries generated by the research agent.
- **`app/`**: A user-facing Gradio web application that connects to the agent after it has been deployed to Vertex AI Agent Engine.

## Architecture

This demo uses a three-tiered architecture: a user-facing web app, a Vertex AI Agent Engine to host the agent logic, and a backend vector search service for product retrieval.

```ascii
+----------+
|          |
|   User   |
|          |
+----------+
     |
     | 1. User Question (HTTPS)
     v
+-------------------------------------------------------------------+
| Google Cloud                                                      |
|                                                                   |
|  +-------------------------------------------------------------+  |
|  | Gradio Web App                                              |  |
|  | (Cloud Run)                                                 |  |
|  +-------------------------------------------------------------+  |
|                 |                                                 |
|                 | 2. Query Agent Engine                           |
|                 v                                                 |
|  +-------------------------------------------------------------+  |
|  | Vertex AI Agent Engine                                      |  |
|  |                                                             |  |   
|  |  +-----------------------+   +--------------------------+   |  |
|  |  | Shopper Concierge     |-->| Research Sub-Agent       |   |  |   
|  |  | (Root Agent)          |   | (Uses Google Search)     |   |  |   
|  |  +-----------------------+   +--------------------------+   |  |
|  |            |                                                |  |
|  +------------|------------------------------------------------+  |
|               | 3. Call Vector Search API                         |
+---------------|---------------------------------------------------+
                |
                v
+----------------------------------+
|                                  |
| Vector Search Backend            |
| (External API Endpoint)          |
|                                  |
+----------------------------------+
```

### Diagram Description

1.  **Gradio Web App**: A user-friendly interface (deployed as a Cloud Run service) that captures the user\'s request.
2.  **Vertex AI Agent Engine**: Hosts the deployed Shopper\'s Concierge agent. It receives the request from the Gradio app. The root agent first calls the `research_agent` sub-agent, which uses Google Search to refine the user\'s query.
3.  **Vector Search Backend**: The root agent then uses the refined queries to call an external vector search API via its `find_shopping_items` tool to retrieve relevant products.
4.  **Response**: The final, curated list of products is sent back through the Agent Engine to the Gradio app and displayed to the user.

## Getting Started

### 1. Prerequisites

This project has two main components: the ADK agent (`shopper_concierge`) and the Gradio UI (`app`). Each has its own dependencies.

*   **Install dependencies for the agent**:
    ```bash
    # From the repository root, navigate to the agent\'s directory
    cd shopper-concierge-demo/shopper_concierge

    # Create and activate a virtual environment
    uv venv
    source .venv/bin/activate

    # Install packages
    uv pip install -r requirements.txt
    ```

*   **Install dependencies for the Gradio app**:
    ```bash
    # From the repository root, navigate to the app\'s directory
    cd shopper-concierge-demo/app

    # Create and activate a virtual environment
    uv venv
    source .venv/bin/activate

    # Install packages
    uv pip install -r requirements.txt
    ```

### 2. Running Locally

Running the full solution locally requires deploying the agent to Vertex AI Agent Engine first.

1.  **Vector Search Backend**:
    *   This agent is configured to work with a specific vector search backend API. The default URL is `https://www.ac0.cloudadvocacyorg.joonix.net/api/query` as defined in `shopper_concierge/tools.py`.
    *   You can modify this file to point to your own compatible vector search endpoint.

2.  **Deploy the Agent to Vertex AI Agent Engine**:
    *   **Authenticate with Google Cloud**:
        ```bash
        gcloud auth login
        gcloud config set project your-gcp-project-id
        ```
    *   **Run the ADK deployment command**:
        From the repository root (`./my-adk-python-samples`), run the `adk deploy agent_engine` command. This command packages your agent and deploys it to a new or existing Agent Engine instance.

        **Command Syntax:**
        ```bash
        adk deploy agent_engine [OPTIONS] AGENT_PATH
        ```

        **Example:**
        ```bash
        adk deploy agent_engine shopper_concierge_demo/shopper_concierge \
          --staging_bucket="gs://your-gcs-bucket-for-staging" \
          --display_name="Shopper Concierge" \
          --project="your-gcp-project-id" \
          --region="us-central1"
        ```

        **Key Parameters:**
        *   `AGENT_PATH`: The path to your agent\'s source code directory (e.g., `shopper_concierge_demo/shopper_concierge`).
        *   `--staging_bucket`: **(Required)** A Google Cloud Storage bucket used to store deployment artifacts. You must create this bucket first.
        *   `--display_name`: The name for your agent as it will appear in the Vertex AI console.
        *   `--project`: Your Google Cloud Project ID.
        *   `--region`: The Google Cloud region where you want to deploy the agent (e.g., `us-central1`).

    *   After running the command, the deployment process will begin. Once it\'s complete, **copy the `AGENT_ENGINE_ID`** from the output. You\'ll need it to configure the Gradio UI.

3.  **Configure and Run the Gradio App Locally**:
    *   To test the Gradio UI on your local machine, first navigate to the app directory:
        ```bash
        cd shopper-concierge-demo/app
        ```
    *   Create a `.env` file from the example:
        ```bash
        cp .env.example .env
        ```
    *   Edit `.env` and fill in your Google Cloud project details and the `AGENT_ENGINE_ID` obtained from the previous step.
    *   Run the app locally:
        ```bash
        python main.py
        ```
    *   Open the provided URL in your browser to interact with your deployed agent.


## Example Usage

Once the Gradio app is running, you can ask the assistant for product recommendations.

**Example prompt:**
> "Can you find birthday present for 10 years old son?"

The agent will first use its research capabilities to understand what "lightweight" and "long battery life" mean in the context of laptops currently on the market. It will then use this understanding to query the product catalog and return specific recommendations.

## References

- [(YouTube) Build AI agents for e-commerce with ADK + Vector Search](https://www.youtube.com/watch?v=UIntXBP--gI)
- [Agent Development Kit (ADK)](https://goo.gle/3RGrB9T)
- [Shopper\'s Concierge demo video](https://goo.gle/4jRbMJb)
- [Shopper\'s Concierge sample notebook](https://goo.gle/4kMkxot)
- [Deploying ADK agent with MCP tools on VertexAI Agent Engine](https://github.com/googleapis/python-aiplatform/issues/5372#issuecomment-3181870896)
